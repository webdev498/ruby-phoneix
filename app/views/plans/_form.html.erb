<%# plan form %>

<%= form_for( @plan ) do |f| %>

  <div class="col-lg-10 phx-working-area-background">

	  <!-- working area title and nav -->
	  <div class="row span10 phx-working-area-nav">

        <%# temporarily disable hamburger  with  type="button" %>
        <div class="col-xs-1 phx-hamburger-box">
            <button type="button" class="phx-hamburger">|||</button>
        </div>

	    <div style="height:50px;">
			<row>
				<div class="col-lg-8">
			      <div class="phx-working-area-title">Third Party Management
			      </div>
				</div>
				<div class="col-lg-3 phx-working-area-title-buttons">
			      <p>
			      </p>
				</div>
			</row>
		</div>
	</div>

	<!-- working area -->
	<div class="containter-fluid" style="padding-top:30px;">

		<!-- Primary Info -->
        <div class="col-lg-4">

					<div class="phx-primary-info-column">

						<div class="field form-group phx-input-control-ccer"> &nbsp;
						</div>

						<div class="col-md-6 form-group phx-input-control">
							<label class="phx-form-control-label" for="plan_id_code">Paytype Code</label>
							<%= f.text_field :plan_id_code, class: 'phx-form-control' %>
						</div>

						<div class="col-md-6 form-group phx-input-control">
							<label class="phx-form-control-label" for="account_number">Account Number</label>
							<%= f.text_field :account_number, class: 'phx-form-control' %>
						</div>

						<div class="field form-group phx-input-control">
							<label class="phx-form-control-label" for="insurance_plan_name">Plan Name</label>
							<%= f.text_field :insurance_plan_name, class: 'phx-form-control' %>
						</div>

						<div class="field form-group phx-input-control">
							<label class="phx-form-control-label" for="abbreviated_name">Abbreviated Name</label>
							<%= f.text_field :abbreviated_name, class: 'phx-form-control' %>
						</div>

            <%= phx_selectfield_for f, :plan_type, "Plan Type", Plan.plan_types %>
            <%= phx_selectfield_for f, :payor_type, "Payor Type", Plan.payor_types %>

						<div class="row phx-two-horizontal-controls">
							<div class="col-md-6 form-group phx-input-control">
								<label class="phx-form-control-label" for="bin_number">Bin Number</label>
								<%= f.text_field :bin_number, class: 'phx-form-control' %>
							</div>

							<div class="col-md-6 form-group phx-input-control">
								<label class="phx-form-control-label" for="processor_control_number">Proc. Control #</label>
								<%= f.text_field :processor_control_number, class: 'phx-form-control' %>
							</div>
						</div>

						<div class="row phx-two-horizontal-controls">
							<div class="col-md-6 form-group phx-input-control">
								<label class="phx-form-control-label" for="address2">Version Number</label>
								<%= f.text_field :address2, class: 'phx-form-control' %>
							</div>

							<div class="col-md-6 form-group phx-input-control">
								<label class="phx-form-control-label" for="company_id">Software ID</label>
								<%= f.text_field :company_id, class: 'phx-form-control' %>
							</div>
						</div>

						<div class="row phx-two-horizontal-controls">
							<div class="col-md-6 form-group phx-input-control">
								<label class="phx-form-control-label" for="pharmacy_id">ID Qualifier</label>
								<%= f.text_field :pharmacy_id, class: 'phx-form-control' %>
							</div>

							<div class="col-md-6 form-group phx-input-control">
								<label class="phx-form-control-label" for="provider_number">Provider ID</label>
								<%= f.text_field :provider_number, class: 'phx-form-control' %>
							</div>
						</div>

						<div class="field form-group phx-input-control">
							<label class="phx-form-control-label" for="address2">Copay Assistance Plan</label>
							<%= f.text_field :address2, class: 'phx-form-control' %>
						</div>

            <%= phx_selectfield_for f, :copay_type, "Copay Type", Plan.copay_types %>

            <div class="row phx-two-horizontal-controls">

              <%= phx_selectfield_for f, :support_split_billing, "Split Billing", Plan.support_split_billings, false, 0, "col-md-6", true %>
              <%= phx_textfield_for f, :split_bill_format, "Split Bill Format", 0, "col-md-6" %>
  					</div>

            <%= phx_red_submit_button_for f, "Plan", [], "", "phx-btn-model-control-width pull-right", false %>

            <div class="phx-input-control-spacer">&nbsp;</div>
            <div class="phx-input-control-spacer">&nbsp;</div>
            <div class="phx-input-control-spacer">&nbsp;</div>

					</div> <!-- end of container fluid for Primary Info -->
				</div> <!-- end of Primary Info col lg def -->

	        <div class="col-lg-8">

				<!-- Tab labels -->
				<ul class="nav nav-tabs" role="tablist">
					<li class="active"><a href="#generalPane" role="tab" data-toggle="tab">General Info</a></li>
				</ul>

			<!-- Tab panes -->
			<div class="tab-content phx-tab-pane">

				<div class="tab-pane active" id="generalPane">

					<div class="container-fluid">

						<row>

							<!-- GENERAL INFO, first column -->
							<div class="container-fluid col-lg-4">

								<div class="field form-group phx-input-control">
									<label class="phx-form-control-label" for="address1">Address 1</label>
									<%= f.text_field :address1, class: 'phx-form-control' %>
								</div>

								<div class="field form-group phx-input-control">
									<label class="phx-form-control-label" for="address2">Address 2</label>
									<%= f.text_field :address2, class: 'phx-form-control' %>
								</div>

								<div class="field form-group phx-input-control">
									<label class="phx-form-control-label" for="city">City</label>
									<%= f.text_field :city, class: 'phx-form-control' %>
								</div>

								<div class="row phx-two-horizontal-controls">
									<div class="col-md-6 form-group phx-input-control">
										<label class="phx-form-control-label" for="state">State</label>
										<%= f.text_field :state, class: 'phx-form-control' %>
									</div>

									<div class="col-md-6 form-group phx-input-control">
										<label class="phx-form-control-label" for="zip_code">Zip Code</label>
										<%= f.text_field :zip_code, class: 'phx-form-control' %>
									</div>
								</div>

                <%= phx_selectfield_for f, :print_sort_code, "Print Sort Code", Plan.print_sort_codes %>

                </br>

								<%= phx_checkbox_for f, :authorization_on_label, "Authorization Number on Label" %>
                                </br>
								<%= phx_checkbox_for f, :plan_info_on_label, "Plan Info on Label" %>
                                </br>
								<%= phx_checkbox_for f, :submit_as_cash, "Submit as Cash" %>
                                </br>
								<%= phx_checkbox_for f, :do_discounts_apply, "Discounts Apply" %>

                </br>

                            </div> <!-- END OF first panel, first column -->

              <% if(@plan.plan_requirement) %>
                <!-- GENERAL INFO panel, second column -->
                <div class="container-fluid col-lg-4">
										<div class="field form-group phx-input-control">
											<label class="phx-form-control-label" for="claim_seg_sel">Claim Segments</label>
											<%#= f.text_field :address1, class:'phx-form-control' %>
                      <select id="claim_seg_sel" class='phx-form-control'>
                        <option value="insurance">Insurance Segment</option>
                        <option value="patient">Patient Segment</option>
                        <option value="pricing">Pricing Segment</option>
                        <option value="pharmacy">Pharmacy Segment</option>
                        <option value="prescription1">Prescription#1 Segment</option>
                        <option value="prescription2">Prescription#2 Segment</option>
                        <%= option_helper(@plan.plan_requirement.coordination_of_benefits_segment, 'coordination') do -%>
                            Coordination Of Benefits Segment
                        <% end -%>
                        <%= option_helper(@plan.plan_requirement.compound_segment, 'compound') do -%>
                            Compound Segment
                        <% end -%>
                        <%= option_helper(@plan.plan_requirement.drug_utilization_review_segment, 'drug') do -%>
                            Drug Utilization Review Segment
                        <% end -%>
                        <%= option_helper(@plan.plan_requirement.coupon_segment, 'coupon') do -%>
                          Coupon Segment
                        <% end -%>
                        <%= option_helper(@plan.plan_requirement.prescriber_segment,'prescriber') do -%>
                            Prescriber Segment
                        <% end -%>
                        <%= option_helper(@plan.plan_requirement.prior_authorization_segment,'prior_authorization') do -%>
                            Prior Authorization Segment
                        <% end -%>
                        <%= option_helper(@plan.plan_requirement.facility_segment, 'Facility') do -%>
                            Facility Segment
                        <% end -%>
                        <%= option_helper(@plan.plan_requirement.clinical_segment,'clinical') do -%>
                          Clinical Segment
                        <% end -%>
                        <%= option_helper(@plan.plan_requirement.workers_compensation_segment,'compensation') do -%>
                          Workers Compensation Segment
                        <% end -%>

                      </select>
                    </div>
                    <%= form_for([@plan, @plan.plan_requirement]) do |rf| %>
                      <% @segment_ary.each do |key, val| %>
                        <% val[0].each_index do |i| %>
                            <% if i < (val[0].length <=22 ? 11 : (val[0].length/2.to_f).ceil) %>
                              <div class="field form-group phx-input-control ctrl-segment ctrl-<%=key%>">
                                <label class="phx-form-control-label"  for="patient_brithdate"> <%= val[1][i].split.map(&:capitalize)*' ' %> </label>
                                <%= rf.select val[0][i], [['Not Used', 0], ['Send on New', 1], ['Send on Reversal', 2], ['Send on New and Reversal', 3]], {}, class: 'phx-form-control'%>
                              </div>
                            <% end %>
                        <% end %>
                      <% end %>
                    <% end %>
									</div> <!-- END OF GENERAL INFO panel, second column -->

                <!-- GENERAL INFO panel, third column -->
                <div class="container-fluid col-lg-4">
                <div style="margin-bottom: 13px"  class="phx-input-control-spacer">&nbsp;</div>
                <%= form_for([@plan, @plan.plan_requirement]) do |rf| %>
                    <% @segment_ary.each do |key, val| %>
                        <% val[0].each_index do |i| %>
                            <% if i >= (val[0].length <=22 ? 11 : (val[0].length/2.to_f).ceil) %>
                                <div class="field form-group phx-input-control ctrl-segment ctrl-<%=key%>">
                                  <label class="phx-form-control-label"  for="patient_brithdate"> <%= val[1][i].split.map(&:capitalize)*' ' %> </label>
                                  <%= rf.select val[0][i], [['Not Used', 0], ['Send on New', 1], ['Send on Reversal', 2], ['Send on New and Reversal', 3]], {}, class: 'phx-form-control'%>
                                </div>
                            <% end %>
                        <% end %>
                    <% end %>
                <% end %>

              </div> <!-- END OF GENERAL INFO panel, third column -->
              <% end %>
            </row>
							</div> <!-- END OF GENERAL INFO panel container-fluid -->
						</div>

						<div class="tab-pane" id="claimPanel2">
							<div class="container-fluid">
								<row>
									<!-- PLAN panel, 1st column -->
									<div class="container-fluid col-lg-4">
									</div> <!-- END OF SECOND panel, second column -->

									<!-- PLAN panel, 1st column -->
									<div class="container-fluid col-lg-4">
									</div> <!-- END OF PLAN panel, second column -->
								</row>
							</div> <!-- END OF PLAN panel container-fluid -->
						</div>

						<div class="tab-pane" id="claimPanel3">
							<div class="container-fluid">
								<row>
									<!-- PLAN CONT'D panel, 1st column -->
									<div class="container-fluid col-lg-4">
									</div> <!-- END OF SECOND panel, second column -->

									<!-- PLAN CONT'D panel, 1st column -->
									<div class="container-fluid col-lg-4">
									</div> <!-- END OF PLAN CONT'D panel, second column -->
								</row>
							</div> <!-- END OF PLAN CONT'D panel container-fluid -->
						</div>
		</div>
	<% end %>
</div> <!-- end of col lg 10 -->

<script>
    $(document).ready(function(){
        $('#plan_plan_id_code').keydown(function(evt) {
            var ch = evt.which;

            if (ch == 13) {
                $.get('getid?plan_id_code=' + $(this).val(),function(data){
                    if(data == -1 )
                        return;
                    location.href = data;
                });
            }
        });
    });

</script>
