<div class="phx-modal containter-fluid" id="planSearchModal" role="dialog" aria-hidden="true">

	<div class="modal-dialog">
		<div class="modal-content">

			<div class="modal-header">
				<h3>Plan Search</h3>
			</div>

			<div class="modal-body">
				<% choice = 0 %>
				<table class="table">
		  		<thead class="phx-search-row-header">
  		  		<tr>
						<th class="phx-search-font"><input type="text" id="planSearchModal_Keys1_9" style="width:0.5px;" ></th>
						<th class="phx-search-font">NDC</th>
						<th class="phx-search-font">GNC</th>
						<th class="phx-search-font">Synonym</th>
						<th class="phx-search-font">Plan Name</th>
						<th class="phx-search-font">Active</th>
						<th class="phx-search-font">DEA Schedule<th>
		  		</tr>
  				</thead>

		  		<tbody>
						<% searchPlans.each do |plan| %>

							<% planSearchRowId = "itemRow" + (choice += 1).to_s %>
							<tr	id="<%=itemSearchRowId%>"
									class="phx-search-row clickable-itemRow"
									data-phx-search-item-id="<%= item.id %>"
									data-phx-search-item-name="<%= item.display_name %>"
									data-phx-search-item-ndc-number="<%= item.ndc_number %>" >

								<td class="phx-search-font"> <%= choice %> </td>
								<td class="phx-search-font"> <%= item.ndc_number %> </td>
								<td class="phx-search-font"> <%= item.gcnseq_number %> </td>
								<td class="phx-search-font"> <%= item.synonym %> </td>
								<td class="phx-search-font"> <%= item.item_name %> </td>
								<td class="phx-search-font"> <%= item.active_flag ? "Yes" : "No" %> </td>
								<td class="phx-search-font"> <%= item.dea_schedule%> </td>
							</tr>
						<% end %> <!-- END OF item list -->
 			 		</tbody>
				</table>
			</div> <!-- end of modal-body -->

			</br>

			<div class="modal-footer">
				<%=	paginate searchItems,
						params: { controller: "items", action: "nextItems"} , remote: true  unless searchItems.empty? %>

				<%= link_to "New Item",
						item_path,
						id: "createNewItemButton",
						method: "get",
						class: "btn btn-sm btn-default phx-btn-model-control-red" %>

				<button id="item_modal_close_btn"
						class="btn btn-sm btn-default phx-btn-model-control-red"
						data-dismiss="modal"
						aria-hidden="true">
						Close</button>
			</div>

		</div>  <!-- end of modal-content -->

	</div>  <!-- end of modal-dialog -->

	<script>

		//<%# signal that a search selection has been made, and provide the ID and Name %>
		//<%# the calling view MUST define the "phx-selected-item" custom event  %>
		function triggerSearchSelection( selectedSearchItem ) {
			$( document ).trigger( "phx-selected-item",
										[ selectedSearchItem.data("phxSearchItemId"),
										  selectedSearchItem.data("phxSearchItemName"),
										  selectedSearchItem.data("phxSearchItemNdcNumber") ] );
			$('#item_modal_close_btn').trigger("click");
			}

		// handle a click event on any of the search rows
		$(".clickable-itemRow").click(function() {
			// send the jQuery version of "this"
			triggerSearchSelection( $(this) );
			});

		// handle a number selection on the search
		$('#itemSearchModal_Keys1_9').on("keypress", function(e) {
				var key = e.charCode ? e.charCode : e.keyCode ? e.keyCode : 0;

				if( key >= 48 && key <= 57 ) {
						triggerSearchSelection( $("#itemRow" + (key-48).toString()) );
						return false; }
				if (key == 27) { $("#itemSearchModal_close_btn").trigger("click"); return false; }
				if (key == 43) { $("#createNewItemButton").trigger("click"); return false; }
			});

	</script>

</div>
